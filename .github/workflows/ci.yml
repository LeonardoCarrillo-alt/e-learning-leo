# name: frontend-deploy
# on:
#   workflow_dispatch:
#   push:
#     branches: [ main ]
#       - 'elearning-frontend/**'
#     paths:
# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'
#           cache-dependency-path: elearning-frontend/package-lock.json
#       - run: npm ci
#         working-directory: elearning-frontend
#       - run: npm run build
#         working-directory: elearning-frontend
#       - run: tar -C elearning-frontend -czf frontend-dist.tar.gz dist
#       - run: |
#           echo "${{ secrets.EC2_SSH_KEY }}" > key.pem
#           chmod 600 key.pem
#           scp -i key.pem -o StrictHostKeyChecking=no frontend-dist.tar.gz "${{ secrets.EC2_USER }}@${{ secrets.EC2_HOST }}:/tmp/frontend-dist.tar.gz"
#           ssh -i key.pem -o StrictHostKeyChecking=no "${{ secrets.EC2_USER }}@${{ secrets.EC2_HOST }}" "sudo apt-get update -y && sudo apt-get install -y nginx && sudo mkdir -p /var/www/elearning-frontend && sudo tar -xzf /tmp/frontend-dist.tar.gz -C /var/www/elearning-frontend && sudo chown -R www-data:www-data /var/www/elearning-frontend && echo 'server { listen 80; server_name _; root /var/www/elearning-frontend/dist; index index.html; location / { try_files \$uri /index.html; } }' | sudo tee /etc/nginx/sites-available/elearning-frontend >/dev/null && sudo ln -sf /etc/nginx/sites-available/elearning-frontend /etc/nginx/sites-enabled/elearning-frontend && sudo rm -f /etc/nginx/sites-enabled/default && sudo nginx -t && sudo systemctl restart nginx"